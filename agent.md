# Leon Agent 项目背景

## 背景

观察 Windsurf Cascade 的实现方式，发现其核心是通过工具调用（read_file、edit_file、bash 等）与代码库交互。想要理解这类 AI 编程助手的实现机制，最直接的方式是自己实现一个。

LangChain 提供了 Agent 框架，但传统的 Tool 模式在处理复杂场景时存在局限：工具定义分散、安全控制不统一、难以实现跨工具的状态管理。LangChain 0.3 引入的 Middleware 模式提供了新思路：在模型调用前后插入逻辑，统一处理工具注入、参数验证、结果转换。

## 目标

通过 Middleware 架构实现 Cascade 的核心能力，验证这种架构是否比传统 Tool 模式更适合构建 AI 编程助手。

具体要解决的问题：
1. 如何用 Middleware 统一管理文件操作、搜索、命令执行等工具
2. 如何在 Middleware 层实现路径验证、权限控制、审计日志
3. 如何处理异步工具调用和 shell session 持久化
4. 如何在 TUI 中实现流式响应和工具调用可视化

非目标：不追求功能完整性，只实现核心工具；不考虑生产环境部署，专注于架构验证。
