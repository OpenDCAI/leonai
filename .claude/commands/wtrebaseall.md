# æ‰¹é‡ Rebase æ‰€æœ‰ Worktree

ä¸€ä¸ª PR åˆå¹¶åˆ° main åï¼Œæ‰¹é‡å°†æ‰€æœ‰ in-progress worktree rebase åˆ°æœ€æ–° `origin/main`ã€‚

## ä½¿ç”¨æ—¶æœº

æŸä¸ªåˆ†æ”¯çš„ PR åˆå¹¶åï¼ˆå°¤å…¶æ˜¯ rebase and mergeï¼‰ï¼Œå…¶ä»– worktree çš„ base å·²è¿‡æ—¶ï¼Œç»Ÿä¸€æ›´æ–°ã€‚

## Step 0ï¼šå®šä½ä¸»ä»“åº“

```bash
MAIN_REPO=$(git worktree list | head -1 | awk '{print $1}')
```

åœ¨ä¸»ä»“åº“æˆ–ä»»æ„ worktree ä¸‹æ‰§è¡Œå‡å¯ã€‚

## Step 1ï¼šåŒæ­¥è¿œç«¯

```bash
git fetch origin
```

## Step 2ï¼šéå†æ‰€æœ‰ worktree

å¯¹æ¯ä¸ª worktree é€ä¸€å¤„ç†ï¼ˆè·³è¿‡ä¸»ä»“åº“æœ¬èº«ï¼‰ï¼Œæ— è®ºåœ¨ `~/worktrees/` è¿˜æ˜¯æ—§è·¯å¾„ `$MAIN_REPO/worktrees/`ï¼š

```bash
git worktree list --porcelain
```

**è·³è¿‡æ¡ä»¶ï¼š**
- å½“å‰ worktree å°±æ˜¯ä¸»ä»“åº“
- å¯¹åº”åˆ†æ”¯çš„ PR å·² merged/closedï¼ˆæ ‡è®°å»ºè®®ç”¨ `wtrm` æ¸…ç†ï¼‰

**å¤„ç†æµç¨‹ï¼š**

```
DIRTY æ£€æŸ¥
â”œâ”€â”€ æœ‰æœªæäº¤æ”¹åŠ¨ â†’ è·³è¿‡ï¼Œæ ‡è®°ä¸º"éœ€æ‰‹åŠ¨å¤„ç†"
â””â”€â”€ å¹²å‡€ â†’ git -C <path> rebase origin/main
         â”œâ”€â”€ æˆåŠŸ â†’ æ ‡è®° âœ…
         â””â”€â”€ æœ‰å†²çª â†’ git -C <path> rebase --abortï¼ˆå›æ»šï¼‰
                      æ ‡è®°ä¸º"éœ€æ‰‹åŠ¨å¤„ç†"ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
```

å†²çªæ—¶è‡ªåŠ¨ abort è€Œä¸æ˜¯åœä¸‹æ¥ç­‰å¾…ï¼Œä¿è¯æ‰¹é‡æ“ä½œä¸ä¼šå¡ä½ã€‚

## Step 3ï¼šæ±‡æ€»æŠ¥å‘Š

```
wtrebaseall å®Œæˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… æˆåŠŸ rebaseï¼š
  - ~/worktrees/leon--feat-x (feat/x)  +2 æ–° commit
  - ~/worktrees/leon--fix-y  (fix/y)   å·²æ˜¯æœ€æ–°

âš  è·³è¿‡ï¼ˆæœ‰æœªæäº¤æ”¹åŠ¨ï¼Œéœ€æ‰‹åŠ¨å¤„ç†ï¼‰ï¼š
  - ~/worktrees/leon--wip-z (wip/z)

âŒ å†²çªï¼ˆå·² abortï¼Œéœ€æ‰‹åŠ¨å¤„ç†ï¼‰ï¼š
  - worktrees/old-a (old/a)
    æç¤ºï¼šcd worktrees/old-a && git rebase origin/main

ğŸ—‘ å»ºè®®æ¸…ç†ï¼ˆPR å·²å…³é—­ï¼‰ï¼š
  - worktrees/done-b (done/b) â†’ PR #9 merged
    æ‰§è¡Œï¼š/wtrm done/b
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æˆåŠŸ 2 / è·³è¿‡ 1 / å†²çª 1 / å¾…æ¸…ç† 1
```

æŠ¥å‘Šä¸­ä½¿ç”¨ `git worktree list` è¿”å›çš„å®é™…è·¯å¾„ï¼Œå…¼å®¹æ–°æ—§ä¸¤ç§ä½ç½®ã€‚
