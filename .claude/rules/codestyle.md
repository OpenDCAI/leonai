# 代码风格规范

## 代码风格与结构
- 禁止 monkeypatch，避免破坏模块边界
- 禁止函数嵌套函数，提高可读性和可测试性
- 无必要不新增实体，保持简洁
- 单一职责原则（SRP）：每个类/函数只做一件事
- KISS / YAGNI：拒绝花哨写法，不实现用不到的功能
- 命名即文档

## 工程与健壮性
- Fail Fast：异常/不合法输入立即报错
- 依赖显式声明，不搞隐式耦合
- 禁止全局状态共享（单例、全局变量）
- 限制副作用：函数尽量纯净
- 类型安全（Pydantic）：数据输入输出必须强类型校验

## 可维护性
- DRY：拒绝复制粘贴逻辑
- 模块边界清晰：通过接口交互，禁止跨层调用
- 注重可测试性
- 新增模块/接口必须有最小文档

## 协作与安全
- 默认拒绝隐式魔法（metaclass、动态 import）
- 安全优先：避免 eval/exec、危险反序列化
- 渐进演化：功能演进要有清晰迁移路径

## 设计模式
- 优先：工厂、策略、适配器、组合优于继承、轻量依赖注入
- 谨慎：观察者/发布订阅（限事件流）、装饰器（避免嵌套）、模板方法
- 禁止：单例、过度 MVC/MVP/MVVM、访问者/复杂组合、反射/动态代理

## 迭代原则
- 小步快跑：功能可拆分则必须拆分，逐步交付
- MVP：先做最小可用版本，再逐步完善
- 反馈驱动：尽早拿到反馈

## 可观测性
- 核心逻辑必须有日志，保证可追溯
- 区分「预期异常」与「系统错误」，避免吞异常
