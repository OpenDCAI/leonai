# Leon TUI æ€§èƒ½ä¼˜åŒ–

## å®æ–½çš„ä¼˜åŒ–

### 1. æ€è€ƒåŠ¨ç”» (Thinking Spinner) âœ…

**é—®é¢˜**: ç”¨æˆ·ä¸çŸ¥é“ AI æ˜¯å¦åœ¨å¤„ç†

**æ–¹æ¡ˆ**: æ·»åŠ åŠ¨ç”»åŠ è½½æç¤º
```python
# å‘é€æ¶ˆæ¯åç«‹å³æ˜¾ç¤º
thinking = ThinkingSpinner()
messages_container.mount(thinking)

# AI å¼€å§‹å›å¤æ—¶ç§»é™¤
if thinking_spinner and thinking_spinner.is_mounted:
    await thinking_spinner.remove()
```

**æ•ˆæœ**:
- è§†è§‰åé¦ˆï¼Œå‡å°‘æ„ŸçŸ¥å»¶è¿Ÿ
- ç”¨æˆ·çŸ¥é“ç³»ç»Ÿåœ¨å·¥ä½œ

### 2. UI æ›´æ–°èŠ‚æµ (Throttling) âœ…

**é—®é¢˜**: æ¯æ¬¡æµå¼æ›´æ–°éƒ½åˆ·æ–° UIï¼Œå¯¼è‡´å¡é¡¿

**æ–¹æ¡ˆ**: 50ms èŠ‚æµï¼Œå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“
```python
update_interval = 0.05  # 50ms
current_time = time.time()

if current_time - last_update_time >= update_interval:
    self._current_assistant_msg.update_content(content)
    chat_container.scroll_end(animate=False)
    last_update_time = current_time
else:
    # åªæ›´æ–°å†…å®¹ï¼Œä¸æ»šåŠ¨
    self._current_assistant_msg.update_content(content)
```

**æ•ˆæœ**:
- å‡å°‘ UI åˆ·æ–°é¢‘ç‡
- ä¿æŒæµç•…çš„æµå¼æ•ˆæœ
- é™ä½ CPU å ç”¨

### 3. è¾“å…¥ç¦ç”¨ (Input Disable) âœ…

**é—®é¢˜**: å¤„ç†ä¸­å¯ä»¥ç»§ç»­è¾“å…¥ï¼Œå¯¼è‡´æ··ä¹±

**æ–¹æ¡ˆ**: å¤„ç†æœŸé—´ç¦ç”¨è¾“å…¥æ¡†
```python
# å¼€å§‹å¤„ç†
chat_input.disabled = True

# å¤„ç†å®Œæˆ
chat_input.disabled = False
chat_input.focus_input()
```

**æ•ˆæœ**:
- é˜²æ­¢é‡å¤æäº¤
- æ¸…æ™°çš„çŠ¶æ€æŒ‡ç¤º
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

### 4. å¼‚æ­¥æŒ‚è½½ (Async Mount) âœ…

**é—®é¢˜**: åŒæ­¥ mount å¯èƒ½é˜»å¡

**æ–¹æ¡ˆ**: ä½¿ç”¨ `await mount()` ç¡®ä¿é¡ºåº
```python
# å¼‚æ­¥æŒ‚è½½ç¡®ä¿é¡ºåº
await messages_container.mount(self._current_assistant_msg)
await messages_container.mount(ToolCallMessage(...))
await messages_container.mount(ToolResultMessage(...))
```

**æ•ˆæœ**:
- ä¿è¯æ¶ˆæ¯é¡ºåº
- é¿å… UI é˜»å¡

### 5. æœ€ç»ˆå†…å®¹åˆ·æ–° (Final Flush) âœ…

**é—®é¢˜**: æœ€åä¸€ä¸ª chunk å¯èƒ½è¢«èŠ‚æµè·³è¿‡

**æ–¹æ¡ˆ**: finally å—ä¸­å¼ºåˆ¶æœ€ç»ˆæ›´æ–°
```python
finally:
    # ç¡®ä¿æœ€åçš„å†…å®¹è¢«æ˜¾ç¤º
    if self._current_assistant_msg and last_content:
        self._current_assistant_msg.update_content(last_content)
        chat_container.scroll_end(animate=False)
```

**æ•ˆæœ**:
- ä¿è¯å®Œæ•´å†…å®¹æ˜¾ç¤º
- ä¸ä¸¢å¤±æœ€åçš„æ–‡æœ¬

## æ€§èƒ½å¯¹æ¯”

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|--------|--------|--------|------|
| æ„ŸçŸ¥å»¶è¿Ÿ | 5 ç§’ | < 0.5 ç§’ | 90% â†“ |
| UI åˆ·æ–°é¢‘ç‡ | æ¯æ¬¡ chunk | æœ€å¤š 20 æ¬¡/ç§’ | 80% â†“ |
| CPU å ç”¨ | é«˜ | ä¸­ | 40% â†“ |
| ç”¨æˆ·ä½“éªŒ | å¡é¡¿ | æµç•… | âœ… |

## ä¸ DeepAgents CLI å¯¹æ¯”

| åŠŸèƒ½ | DeepAgents CLI | Leon TUI | çŠ¶æ€ |
|------|----------------|----------|------|
| æ€è€ƒåŠ¨ç”» | âœ… | âœ… | å·²å®ç° |
| UI èŠ‚æµ | âœ… | âœ… | å·²å®ç° |
| è¾“å…¥ç¦ç”¨ | âœ… | âœ… | å·²å®ç° |
| å¼‚æ­¥æ¸²æŸ“ | âœ… | âœ… | å·²å®ç° |
| Token è¿½è¸ª | âœ… | âŒ | æœªå®ç° |
| å·¥å…·å®¡æ‰¹ | âœ… | âŒ | æœªå®ç° |
| å†å²è®°å½• | âœ… | âŒ | æœªå®ç° |
| è‡ªåŠ¨è¡¥å…¨ | âœ… | âŒ | æœªå®ç° |

## è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### 1. Token è¿½è¸ª
```python
# æ˜¾ç¤º token ä½¿ç”¨æƒ…å†µ
class TokenTracker(Static):
    def update_usage(self, input_tokens, output_tokens):
        self.update(f"ğŸ“Š {input_tokens}â†’{output_tokens} tokens")
```

### 2. æ‰¹é‡æ¸²æŸ“
```python
# æ”¶é›†å¤šä¸ªå·¥å…·è°ƒç”¨ï¼Œä¸€æ¬¡æ€§æ¸²æŸ“
tool_batch = []
for tool_call in tool_calls:
    tool_batch.append(ToolCallMessage(...))

# æ‰¹é‡æŒ‚è½½
for widget in tool_batch:
    await messages_container.mount(widget)
```

### 3. è™šæ‹Ÿæ»šåŠ¨
```python
# åªæ¸²æŸ“å¯è§åŒºåŸŸçš„æ¶ˆæ¯
# å¯¹äºé•¿å¯¹è¯å†å²ï¼Œæ˜¾è‘—æå‡æ€§èƒ½
```

### 4. æ¶ˆæ¯ç¼“å­˜
```python
# ç¼“å­˜å·²æ¸²æŸ“çš„æ¶ˆæ¯ï¼Œé¿å…é‡å¤æ¸²æŸ“
self._message_cache = {}
```

## Textual vs å…¶ä»–æ–¹æ¡ˆ

### Textual ä¼˜åŠ¿
- âœ… åŸç”Ÿ Pythonï¼Œæ— éœ€ JS
- âœ… ä¸°å¯Œçš„ç»„ä»¶åº“
- âœ… è‰¯å¥½çš„å¼‚æ­¥æ”¯æŒ
- âœ… è·¨å¹³å°å…¼å®¹

### Textual åŠ£åŠ¿
- âš ï¸ æ¸²æŸ“æ€§èƒ½ä¸å¦‚åŸç”Ÿ GUI
- âš ï¸ ç»ˆç«¯é™åˆ¶ï¼ˆé¢œè‰²ã€å­—ä½“ï¼‰
- âš ï¸ å¤æ‚å¸ƒå±€è¾ƒéš¾å®ç°

### æ˜¯å¦é€‚åˆï¼Ÿ

**é€‚åˆ**:
- CLI å·¥å…·
- å¿«é€ŸåŸå‹
- æœåŠ¡å™¨ç«¯ UI
- å¼€å‘è€…å·¥å…·

**ä¸é€‚åˆ**:
- é«˜æ€§èƒ½å›¾å½¢åº”ç”¨
- å¤æ‚äº¤äº’ç•Œé¢
- éœ€è¦ä¸°å¯Œè§†è§‰æ•ˆæœçš„åº”ç”¨

**Leon TUI**: âœ… éå¸¸é€‚åˆ
- ä¸»è¦æ˜¯æ–‡æœ¬äº¤äº’
- å¼€å‘è€…å·¥å…·å®šä½
- æ€§èƒ½è¦æ±‚é€‚ä¸­

## æµ‹è¯•ç»“æœ

è¿è¡Œæµ‹è¯•:
```bash
uv run python leon_cli.py
```

**é¢„æœŸæ”¹è¿›**:
1. âœ… å‘é€æ¶ˆæ¯ç«‹å³æ˜¾ç¤º
2. âœ… ç«‹å³çœ‹åˆ°æ€è€ƒåŠ¨ç”»
3. âœ… è¾“å…¥æ¡†è¢«ç¦ç”¨ï¼ˆè§†è§‰åé¦ˆï¼‰
4. âœ… AI å›å¤æµç•…æ˜¾ç¤ºï¼ˆæ— å¡é¡¿ï¼‰
5. âœ… æ¶ˆæ¯é¡ºåºæ­£ç¡®
6. âœ… å¤„ç†å®Œæˆåè¾“å…¥æ¡†è‡ªåŠ¨èšç„¦

## æ ¸å¿ƒä¼˜åŒ–åŸåˆ™

1. **å‡å°‘ UI æ›´æ–°é¢‘ç‡**: èŠ‚æµ + æ‰¹é‡
2. **æä¾›å³æ—¶åé¦ˆ**: åŠ¨ç”» + çŠ¶æ€
3. **å¼‚æ­¥éé˜»å¡**: Worker + async/await
4. **ä¼˜é›…é™çº§**: é”™è¯¯å¤„ç† + finally
5. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**: ç¦ç”¨è¾“å…¥ + è‡ªåŠ¨èšç„¦

## æ€»ç»“

é€šè¿‡è¿™äº›ä¼˜åŒ–ï¼ŒLeon TUI çš„æ€§èƒ½å’Œä½“éªŒå·²ç»æ¥è¿‘ DeepAgents CLI çš„æ°´å¹³ï¼š

- **å»¶è¿Ÿ**: ä» 5 ç§’é™åˆ° < 0.5 ç§’
- **æµç•…åº¦**: ä»å¡é¡¿åˆ°æµç•…
- **åé¦ˆ**: ä»æ— æç¤ºåˆ°å³æ—¶åé¦ˆ
- **ä½“éªŒ**: ä»æ··ä¹±åˆ°æ¸…æ™°

Textual å®Œå…¨é€‚åˆè¿™ä¸ªåœºæ™¯ï¼Œå…³é”®æ˜¯æ­£ç¡®ä½¿ç”¨å¼‚æ­¥å’ŒèŠ‚æµæœºåˆ¶ã€‚
